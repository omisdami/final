<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Material+Symbols+Outlined" />
  <link rel="stylesheet" href="/static/css/loader.css" />

  <title>Automated Document Preparation by Kinetrics</title>

  <!-- Bootstrap CSS -->
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet" />

  <!-- Custom CSS -->
  <link rel="stylesheet" href="/static/css/style.css" />
</head>

<body>

  <!-- Floating Background Shapes -->
  <div class="floating-shape shape1"></div>
  <div class="floating-shape shape2"></div>
  <div class="floating-shape shape3"></div>

  <!-- Navigation Bar -->
  <nav class="navbar navbar-expand-lg navbar-light bg-white shadow-sm fixed-top">
    <div class="container-fluid">
      <a class="navbar-brand d-flex align-items-center gap-2 sora-font-nav" href="/">
        <span class="material-symbols-outlined">description</span>
        AI Document Generator by Kinectrics
      </a>
      <div class="collapse navbar-collapse">
        <ul class="navbar-nav ms-auto sora-font-nav">
          <li class="nav-item">
            <a class="nav-link" id="newReportTab" href="/generate-report">Get Started</a>
          </li>
          <li class="nav-item">
            <a class="nav-link" id="templatesTab" href="/report-templates">Report Templates</a>
          </li>
          <li class="nav-item">
            <a class="nav-link" href="/targeted-edit">Targeted Editing</a>
          </li>
        </ul>
      </div>
    </div>
  </nav>
  <!-- END Navigation Bar -->

  <!-- Hero Section -->
  <div class="container-fluid text-center mt-5 fade-section sora-font" style="padding-top:100px;">
    <h1 class="fw-bold" style="color:#0066ff;">Generate Reports Effortlessly</h1>
    <p class="text-muted roboto-font">
      Upload your reference, let AI analyze, and get a professional report in minutes.
    </p>
  </div>

  <!-- Progress Bar -->
  <div class="container-fluid my-4 fade-section">
    <div class="progress w-75 mx-auto shadow">
      <div class="progress-bar progress-step" id="progressBar" style="width: 33%">
        Step 1: Upload Reference Material/s (.DOCX/.PDF)
      </div>
    </div>
  </div>

  <!-- Main Content -->
  <div class="container-fluid my-5 fade-section">
    <div class="row g-4">

      <!-- Left: File Upload & Chat -->
      <div class="col-md-8">
        <div class="p-4 bg-white rounded shadow roboto-font">

          <!-- File Upload -->
          <h5 class="d-flex align-items-center gap-2">
            <span class="material-symbols-outlined">upload_file</span>
            Upload Document
          </h5>

          <div class="m-3 d-flex gap-2 align-items-center">
            <select id="templateSelect" class="form-select w-auto" aria-label="Select report template">
              <option value="">Choose Template</option>
            </select>

            <div class="flex-grow-1">
              <input type="file" id="docFile" name="files" class="form-control py-1" multiple />
            </div>

            <button onclick="uploadFile()" class="btn btn-primary px-3 py-1">Start Generating!</button>
          </div>

          <!-- RAG Parameter Configuration Section -->
          <div class="mt-3 p-3 border rounded bg-light">
            <h6 class="d-flex align-items-center gap-2 mb-2">
              <span class="material-symbols-outlined">settings</span>
              RAG Parameters (Optional)
            </h6>
            <p class="text-muted small mb-2">
              Configure how the AI retrieves and processes reference documents. Use presets or customize parameters.
            </p>

            <!-- Preset Selection -->
            <div class="mb-3">
              <label class="form-label small">Parameter Preset</label>
              <div class="d-flex gap-2">
                <select id="ragPresetSelect" class="form-select">
                  <option value="default">Default (Balanced)</option>
                  <option value="high_precision">High Precision</option>
                  <option value="comprehensive">Comprehensive</option>
                  <option value="fast">Fast</option>
                </select>
                <button type="button" class="btn btn-outline-secondary btn-sm" onclick="resetRagParameters()">Reset</button>
              </div>
            </div>

            <!-- Parameter Controls -->
            <div class="row g-2">
              <!-- Similarity Threshold -->
              <div class="col-md-6">
                <label for="similarityThreshold" class="form-label small">
                  Similarity Threshold
                  <span class="text-muted" style="cursor: help;" title="Minimum relevance score to include documents">(?)</span>
                </label>
                <div class="d-flex align-items-center gap-2">
                  <input type="range" class="form-range" id="similarityThreshold"
                         min="0" max="1" step="0.05" value="0.6">
                  <span class="badge bg-secondary" id="similarityThresholdValue">0.6</span>
                </div>
              </div>

              <!-- Top K -->
              <div class="col-md-6">
                <label for="topK" class="form-label small">
                  Top K Results
                  <span class="text-muted" style="cursor: help;" title="Number of top-matching documents to retrieve">(?)</span>
                </label>
                <div class="d-flex align-items-center gap-2">
                  <input type="number" class="form-control form-control-sm" id="topK"
                         min="1" max="50" value="5">
                </div>
              </div>

              <!-- Chunk Size -->
              <div class="col-md-6">
                <label for="chunkSize" class="form-label small">
                  Chunk Size (tokens)
                  <span class="text-muted" style="cursor: help;" title="Size of text chunks to retrieve">(?)</span>
                </label>
                <select class="form-select form-select-sm" id="chunkSize">
                  <option value="256">Small (256)</option>
                  <option value="512" selected>Medium (512)</option>
                  <option value="1024">Large (1024)</option>
                </select>
              </div>

              <!-- Overlap -->
              <div class="col-md-6">
                <label for="overlap" class="form-label small">
                  Overlap (%)
                  <span class="text-muted" style="cursor: help;" title="Percentage of chunk overlap for context continuity">(?)</span>
                </label>
                <div class="d-flex align-items-center gap-2">
                  <input type="number" class="form-control form-control-sm" id="overlap"
                         min="0" max="50" value="15">
                </div>
              </div>
            </div>

            <!-- Validation Errors -->
            <div id="ragValidationErrors" class="alert alert-danger mt-2 d-none"></div>
          </div>

          <!-- Example Document Upload Section -->
          <div class="mt-3 p-3 border rounded bg-light">
            <h6 class="d-flex align-items-center gap-2 mb-2">
              <span class="material-symbols-outlined">style</span>
              Style Example (Optional)
            </h6>
            <p class="text-muted small mb-2">
              Upload an example document to learn writing style and format. The AI will automatically analyze and apply
              the style when generating your report.
            </p>
            <div class="d-flex gap-2 align-items-center">
              <input type="file" id="exampleFile" name="example" class="form-control py-1" accept=".pdf,.docx" />
            </div>
            <div id="stylePreview" class="mt-2 d-none">
              <div class="card">
                <div class="card-body p-2">
                  <small class="text-success">✓ Style example selected: <span id="styleFileName"></span></small>
                  <button class="btn btn-sm btn-outline-danger float-end" onclick="removeStyleExample()">Remove</button>
                </div>
              </div>
            </div>
          </div>

          <!-- Uploaded File Preview -->
          <div id="filePreview" class="card d-none my-3">
            <div class="card-body d-flex justify-content-between align-items-center">
              <span id="fileName"></span>
              <button class="btn btn-sm btn-outline-danger" onclick="removeFile()">Remove</button>
            </div>
          </div>

          <!-- Chat Section -->
          <div class="card mt-4 shadow-sm" id="chatSection" style="display:none;">
            <div class="card-header bg-light d-flex align-items-center gap-2">
              <span class="material-symbols-outlined">smart_toy</span> AI-Generated Content
            </div>
            <div class="card-body" id="chatWindow">
            </div>
            <div class="card-footer d-flex">
              <input type="text" id="userInput" class="form-control me-2" placeholder="Suggest a change..." />
              <button onclick="sendQuestion()" class="btn btn-light sora-font-nav">Send</button>
            </div>
          </div>

          <!-- Combined Row for Download + Feedback -->
          <div class="d-flex justify-content-between align-items-start mt-4 gap-2">

            <!-- Feedback Section -->
            <div id="feedbackSection" class="d-none">
              <div class="p-3 border rounded bg-light shadow-sm text-center">
                <p class="mb-2 fw-semibold">How would you rate this report?</p>
                <div class="star-rating d-flex justify-content-center gap-1 fs-4">
                  <span onclick="submitRating(1)" class="star">★</span>
                  <span onclick="submitRating(2)" class="star">★</span>
                  <span onclick="submitRating(3)" class="star">★</span>
                  <span onclick="submitRating(4)" class="star">★</span>
                  <span onclick="submitRating(5)" class="star">★</span>
                </div>
              </div>
            </div>

            <!-- Download Links -->
            <div id="downloadLinks" class="d-none">
              <div class="p-3 border rounded bg-light shadow-sm text-center">
                <p class="mb-2 fw-semibold">Download latest report</p>
                <div class="d-flex justify-content-center gap-2 flex-wrap">
                  <a id="docxLink" href="#" class="btn btn-outline-primary px-4 py-1" download>
                    DOCX
                  </a>
                  <a id="pdfLink" href="#" class="btn btn-outline-primary px-4 py-1" download>
                    PDF
                  </a>
                </div>
              </div>
            </div>

          </div>


          <!-- Hidden textarea -->
          <textarea id="docContent" style="display:none;"></textarea>
        </div>
      </div>

      <!-- Right: Instructions Panel -->
      <div class="col-md-4 fade-section">
        <div class="card shadow-sm">
          <div class="card-body">
            <h5 class="d-flex align-items-center gap-2">
              <span class="material-symbols-outlined">info</span> How It Works
            </h5>
            <ol class="mt-3">
              <li>Select a report template.</li>
              <li>Upload your reference material (.DOCX or .PDF).</li>
              <li><strong>Optional:</strong> Upload an example document to match its writing style.</li>
              <li>Click "Start Generating!" - the AI will automatically extract and apply the style.</li>
              <li>Review the AI-generated report and make any corrections.</li>
              <li>Download your report as a PDF, Word file, or both!</li>
            </ol>
            <p class="text-muted small">
              <strong>Tip:</strong> If you provide a style example, the AI will automatically analyze and apply its
              formatting, tone, and structure to your generated report.
            </p>
          </div>
        </div>
      </div>

    </div>
  </div>
  <!-- Loader Overlay -->
  <div id="global-loader" class="hidden">
    <div class="loader-backdrop"></div>
    <div class="loader-panel">
      <div class="spinner" aria-hidden="true"></div>
      <p>Generating your document… This may take a moment.</p>
    </div>
  </div>


  <!-- Footer -->
  <footer class="text-center mt-5 text-muted fade-section">
    <hr />
    <p>© 2025 Kinectrics Report Generator | Powered by AI</p>
  </footer>

  <!-- JS -->
  <script src="/static/js/newreport.js"></script>
  <script src="/static/js/fetch-wrapper.js"></script>

  <script src="https://cdn.jsdelivr.net/npm/marked/marked.min.js"></script>
</body>

</html>